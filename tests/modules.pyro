# Not a module.
var foobar;
assert !$is_mod(foobar);

# Importing standard library modules.
import $std;
assert $is_mod($std);

import $std::math;
assert $is_mod(math);
assert $is_f64(math::PI);
assert math::abs(-1) == 1;

import $std::math as alias;
assert $is_mod(alias);
assert $is_f64(alias::PI);
assert alias::abs(-1) == 1;

# Importing .pyro modules. Each module has a mod_name variable and a get_mod_name() function so we
# can check scoping is working properly.
var mod_name = "imports";

def get_mod_name() {
    return mod_name;
}

assert get_mod_name() == "imports";

# ./lib1.pyro
import lib1;
assert $is_mod(lib1);
assert lib1::PI == 3.14;
assert lib1::add(1, 2) == 3;
assert lib1::mod_name == "lib1";
assert lib1::get_mod_name() == "lib1";

var func1 = lib1::get_mod_name;
assert func1() == "lib1";

# ./lib2/self.pyro
import lib2;
assert $is_mod(lib2);
assert lib2::PI == 3.14;
assert lib2::add(1, 2) == 3;
assert lib2::mod_name == "lib2";
assert lib2::get_mod_name() == "lib2";

var func2 = lib2::get_mod_name;
assert func2() == "lib2";

# ./lib2/child1.pyro
import lib2::child1;
assert $is_mod(child1);
assert child1::PI == 3.14;
assert child1::add(1, 2) == 3;
assert child1::mod_name == "lib2::child1";
assert child1::get_mod_name() == "lib2::child1";

var func3 = child1::get_mod_name;
assert func3() == "lib2::child1";

# ./lib3/
import lib3;
assert $is_mod(lib3);

# ./lib3/child1.pyro
import lib3::child1;
assert $is_mod(child1);
assert child1::PI == 3.14;
assert child1::add(1, 2) == 3;
assert child1::mod_name == "lib3::child1";
assert child1::get_mod_name() == "lib3::child1";

var func4 = child1::get_mod_name;
assert func4() == "lib3::child1";

# Test parent importing child.
import lib2;
lib2::test_importing_child();

# Test child importing parent and sibling.
import lib2::child1;
child1::test_importing_parent();
child1::test_importing_sibling();

# Test methods defined on the module object itself.
import $std::math;
assert $is_mod(math);
assert "abs" in math;
assert math:contains("abs");
assert $is_callable(math:get("abs"));
assert $is_map(math:globals());
assert "abs" in math:globals();
