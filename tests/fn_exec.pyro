with mod = $exec("") {
    assert $is_module(mod);
}

with mod = $exec("pub var foo = 1 + 2 + 3;") {
    assert $is_module(mod);
    assert mod::foo == 6;
}

with mod = $exec("pub var foo, bar; foo = $str(123); bar = 'a' + 'b';") {
    assert $is_module(mod);
    assert mod::foo == "123";
    assert mod::bar == "ab";
}

var code = `
pub def add(x, y) {
    return x + y;
}
`;

with mod = $exec(code) {
    assert $is_module(mod);
    assert mod::add(1, 2) == 3;
}

var the_mod = $exec("");
assert $is_module(the_mod);
$exec("pub var foo = 1 + 2 + 3;", "the_mod", the_mod);
assert the_mod::foo == 6;
