def calls_panic() {
    $panic("oh no!");
}


def add(a, b) {
    return a + b;
}


var foo = try 123;
assert foo == 123;


var foo = try 123 !! 456;
assert foo == 123;


var foo = try add(1, 2);
assert foo == 3;


var foo = try (1 + 2);
assert foo == 3;


var foo = try calls_panic();
assert $is_err(foo);
assert foo:count() == 3;
assert foo[0] == "oh no!";


var foo = try calls_panic() !! "fallback";
assert foo == "fallback";


var foo = try add(123, "foo");
assert $is_err(foo);


var foo = try add(123, "foo") !! "fallback";
assert foo == "fallback";


var foo = try try try 123;
assert foo == 123;


var foo = try try try calls_panic();
assert $is_err(foo);
assert foo[0] == "oh no!";


var foo = try try try calls_panic() !! "fallback";
assert foo == "fallback";
